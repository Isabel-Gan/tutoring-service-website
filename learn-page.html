<!DOCTYPE html>
<html>
<head>
<title>ELM | Educate </title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<style>
body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
}
.topnav {
    overflow: hidden;
    background-color: #333;
}

.topnav a {
    float: right;
    color: #f2f2f2;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    font-size: 17px;
}

.topnav a.active {
    background-color: #add8e6;
    color: white;
    float:left;
}

.dropdown {
    float: right;
    overflow: hidden;
}

.dropdown .dropbtn {
    font-size: 17px;  
    border: none;
    outline: none;
    color: white;
    padding: 14px 16px;
    background-color: inherit;
    font-family: inherit;
    margin: 0;
}

.topnav a:hover, .dropdown:hover .dropbtn {
    background-color: white;
    color:black;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

.dropdown-content a {
    float: none;
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
}

.dropdown-content a:hover {
    background-color: #ddd;
}

.dropdown:hover .dropdown-content {
    display: block;
} 

.topnav .search-container {
    float: right;
}

.topnav input[type=text] {
    padding: 6px;
    margin-top: 8px;
    font-size: 17px;
    border: none;
}

.topnav .search-container button {
    float: right;
    padding: 6px 10px;
    margin-top: 8px;
    margin-right: 16px;
    background: #ddd;
    font-size: 17px;
    border: none;
    cursor: pointer;
}

.topnav .search-container button:hover {
    background: #ccc;
}

.card{
    width: 50%;
    margin-left:14%;
    margin-right:36%;
    margin-top: 15px;
    margin-bottom: 15px;
    padding: 8px 14px;
    border-radius: 3px;
    background-color: white;
    box-shadow: inset 0 0 3px grey;
    color: black;
    overflow: hidden;

}
.card button.accept{
    width: 10%;
    margin: 8px;
    padding: 8px;
    background-color: #01a329;
    color: black;
    border: none;
    float:right;
    border: 2px solid #019726;
    font-size:medium;
}
.card button.deny{
    width: 10%;
    margin: 8px;
    padding: 8px 6px;
    background-color:red;
    color: black;
    border: 2px solid #ee0000;
    float:right;
    font-size:medium;
}
.requested {
    margin: 6px 6px 6px 6px;
    padding: 6px;
    background-color: #27b7fa;
    color: white;
    border-radius: 8px;
    font-size: small;
    display:inline-block;
}
.close {
    color: #aaaaaa;
    float: right;
    font-size: 28px;
    font-weight: bold; 
}
.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
.close {
  color: #EEEEEE;
  float: right;
  font-size: 16px;
  font-weight: bold;
  margin-left: 6px;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.request_form {
    width: 50%;
    margin-left:14%;
    margin-right:36%;
    margin-top: 15px;
    margin-bottom: 15px;
    padding: 8px 14px;
    border-radius: 3px;
    background-color: white;
    box-shadow: inset 0 0 3px grey;
    color: black;
    overflow: hidden;

}

.form input{
    overflow: auto;
    
}
</style>
</head>
<body style="background-color: whitesmoke;">
    <div class="topnav">
        <a class="active" href="/home">ELM</a>
        <!-- Search bar:
        <div class="search-container" style = "float:left; margin-left: 15%; width: 50%">
            <form action="/learn/search" method="GET">
              <input type="text" placeholder="Search in Learn..." name="search" style="width: 90%">
              <button type="submit"><i class="fa fa-search"></i></button>
            </form>
        </div> -->
        <!-- We need to actually create pages for educate, learn, motivate-->
        <div class="dropdown" style="float:right; margin-right:5px">
          <button class="dropbtn" onclick="location.href='/profile'" style=" padding-right:30px"><i class="fa fa-user"></i> Profile</button>
          <div class="dropdown-content">
            <a href="/account">Account</a>
            <a href="/signout">Sign Out</a>
          </div>
        </div> 
        <a href="/motivate">Motivate</a>
        <a href="/learn">Learn</a>
        <a href="/educate">Educate</a>
    </div>
    <!--Messages stating if requests have been sent or not. Initially set to not seen,
    and then will show based on if things work-->
    <div class="alert alert-success alert-dismissible fade show" id="success" role="alert">
      You've successfully sent your requests!
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="alert alert-danger alert-dismissible fade show" id="fail" role="alert">
      One of your requests failed to send.
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div id="request_form">
        <!--Maybe instead of a form action, we instead just do an onclick button that once on clicked, we do stuff -->
        <form action="javascript:void(0);" class="request_form" id="requestForm" method="POST">
            <label>Request Details:</label><br>
            <input type="text" placeholder="Subject" id="subject" name="subject"><br><br>
            <textarea type="text" placeholder="Details" id="details" name="details" form="requestForm" rows="4" cols="75" required></textarea><br><br>
            <!--Once they type space, we want to separate that into its own input button that you can delete. If you delete, it's not submitted with the form-->
            <!--Have a checkbox for submit a general query-->
            <label>Specific Requests: </label><br>
            <div id="requestedUsers"></div>
            <input type="text" id="requested" name="requested"><br><br>
            <input type="checkbox" id="general" name="general" value="general">
            <label for="general"> I want to send a general request.</label><br><br>
            <button type="submit">Submit Request</button>
        </form>
    </div>

    <!--List the requests that you have already made-->
    <div id="requests_made">
        <h2 style="margin-left: 15%;">Your requests:</h2>
        <%for(var i = 0; i < requests.length; i++){%>
        <div class="card" id="<%=requests[i].ID%>Card">
            <h4>Subject: <%=requests[i].subject%></h4>
            <%if(requests[i].requested == null){%>
                <h5><span style="color:blue">General </span>Request</h5>
            <%}else{%>
                <h5>Requested <span style="color:blue"><%=requests[i].requested%></span></h5>
            <%}%>
            <p><%=requests[i].details%></p>
            <button class="deny" id="<%=requests[i].ID%>Cancel" onclick="cancelRequest(this.id)">Cancel</button>
        </div>
        <%}%>
    </div>
    <!--List the requests that you have already made-->
    <div id="accepted_requests">
        <h2 style="margin-left: 15%;">Accepted requests:</h2>
        <%for(var i = 0; i < accepted.length; i++){%>
        <div class="card" id="<%=accepted[i].ID%>Card">
            <h3>Accepted by <span style="color:blue"><%=accepted[i].accepted%></span></h3>
            <h4>Subject: <%=accepted[i].subject%></h4>
            <p><%=requests[i].details%></p>
            <button class="deny" id="<%=accepted[i].ID%>Reject<%=accepted[i].accepted%>" style="float:right" onclick="rejectRequest(this.id)">Deny</button>
            <button class="accept" id="<%=accepted[i].ID%>Accept<%=accepted[i].accepted%>" style="float:right" onclick="acceptRequest(this.id)">Accept</button>
        </div>
        <%}%>
    </div>
    <form id="form" style="display:none" method="GET" action="/session/video">
        <input type="text" name="ID">
        <input type="text" name="requested">
        <input type="text" name="accepted">
        <input>
    </form>
</body>
<script>
document.getElementById("requestedUsers").style.display="none";
document.getElementById("success").style.display="none";
document.getElementById("fail").style.display="none";
var origForm = document.getElementById("requestForm").innerHTML;

var $jquery3_5_1 = jQuery.noConflict();
var requested = []
var id = 0;
$('#requestForm').submit(function(event){
    event.preventDefault();
        //create JSON
        users = [];
    while(requested.length > 0){
        var user = requested.pop();
        if(!(user == "")){
            users.push(user.substring(0, user.length-1));
        }
    }
    var subject = document.getElementById("subject").value;
    var details = document.getElementById("details").value;
    var general = document.getElementById("general").checked;
    $jquery3_5_1.ajax({
        type:"POST",
        url: "/learn/request",
        data: JSON.stringify({subject: subject, details:details, general:general, requested: users}),
        contentType: "application/json",
        success: function(data){
            document.getElementById("success").style.display="block";
            document.getElementById("requestForm").reset();
            document.getElementById("requestedUsers").innerHTML = "";
            document.getElementById("requestedUsers").style.display = "none";
        },
        error: function(data){
            document.getElementById("fail").style.display = "block";
            document.getElementById("requestForm").reset();
            document.getElementById("requestedUsers").innerHTML = "";
            document.getElementById("requestedUsers").style.display = "none";
        }
    });
    
});
//when the key changed on input field for requested users
$("#requested").on('keyup', function (e) {
    //if key pressed was space, add it the list of requested users
    if (e.keyCode === 32) {
        var user = document.getElementById("requested").value;
        requested.push(user);
        document.getElementById("requested").value = "";
        //add the input username to the thing
        document.getElementById("requestedUsers").innerHTML += "<div class=\"requested\" id=\""+ id + "\">" + user + "<span class=\"close\" id=\"" + id+ "Close\"onclick=\"removeUser(this.id)\">&times</span></div>"
        document.getElementById("requestedUsers").style.display = "block";
        id++;
    }
});
function removeUser(closeID){
    //remove that element that we don't need. We can't just stop displaying it because the user
    //might make a mistake and enter it again, leading to multiple elements with the same ID.
    var index = closeID.indexOf("Close");
    var cID = closeID.substring(0,index);
    document.getElementById(cID).remove();
    //set to empty if not using
    requested[parseInt(cID)] = "";
}
function cancelRequest(cancelID){
    //remove that element that we don't need. We can't just stop displaying it because the user
    //might make a mistake and enter it again, leading to multiple elements with the same ID.
    var index = cancelID.indexOf("Cancel");
    var cID = cancelID.substring(0,index);
    var user = cID.substring(index+6);
    document.getElementById(cID+"Card").remove();
    $jquery3_5_1.ajax({
        type:"POST",
        url: "/learn/cancel",
        data: JSON.stringify({ID:cID, user: user}),
        contentType: "application/json"
    });
}
function acceptRequest(acceptID){
    var index = acceptID.indexOf("Accept");
    var aID = acceptID.substring(0,index);
    var user = acceptID.substring(index+6);
    $jquery3_5_1.ajax({
        type: "POST",
        url: "/learn/accept",
        data: JSON.stringify({ID:aID,user:user}),
        contentType: "application/json",
        success: function(res){
            var form = document.getElementById("form");
            if(res != null){
                form.elements[0].value = aID;
                form.elements[1].value = res.requested;
                form.elements[2].value = user;
                //var teachingWindow = window.open("", "_blank");
                form.submit();
            }
        }
    })
}
function rejectRequest(rejectID){
    alert("you tried to reject");
}
</script>
</html>